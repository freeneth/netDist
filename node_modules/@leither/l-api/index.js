import Hprose from 'hprose-html5'

// 辅助函数，检测两个数据里面的不同元素，可以方便对比 methods的内容差异
// const difference = (a, b) => a.concat(b).filter(v => !a.includes(v) || !b.includes(v))

const timeout = 30000
const apiMethods = [
  'accept', 'act', 'begin', 'commit', 'checkFile', 'checkRight', 'closeTunnel',
  'createInvCode', 'createFileByData', 'deleteFile', 'deleteInvCode', 'del',
  'exit', 'expire', 'get', 'getAppDownloadKey', 'getGShortUrlKey',
  'getInvCodeInfo', 'getInvTemplate', 'getLFileData', 'getLShortUrlKey',
  'getResByName', 'getTempFileMac', 'getUserInfo', 'getVar', 'getVarByContext', 'grant',
  'hDel', 'hGet', 'hGetAll', 'hKeys', 'hLen', 'hMClear', 'hMGet', 'hMSet',
  'hRevScan', 'hScan', 'hset', 'hSet', 'incr', 'invite', 'lClear', 'lExpire',
  'lExpireAt', 'lIndex', 'lLen', 'login', 'lPersist',
  'lPop', 'lPush', 'lRange', 'lSet', 'lTtl', 'lMClear',
  'openTempFile', 'openTunnel',
  'proxyGet', 'proxyPost', 'pullMsg',
  'readMsg', 'register', 'restart', 'rollback', 'rPop', 'rPush', 'runScript', 'registerScript',
  'runByScriptID', 'taskRunInBackground', 'run',
  'sAdd', 'scan', 'sCard', 'sClear', 'sDiff', 'sendmail', 'sendMsg', 'set', 'setData',
  'setHostIp', 'setInvTemplate',
  'setLFileData', 'setUserInfo', 'sInter', 'sMClear', 'sMembers', 'sRem', 'sUnion',
  'temp2LFile', 'test',
  'updateInvCode', 'ugVerifyCode', 'userGroupAddManager', 'userGroupAddMember',
  'userGroupCreate', 'userGroupDelManager',
  'userGroupDelMember', 'userGroupDestroy', 'userGroupGetInfo', 'userGroupJoin',
  'userGroupSetInfo', "unInstallApp", "uploadApp", "uploadAppFile",
  'veni', "version",
  'zAdd', 'zCard', 'zCount', 'zRange', 'zRangeByScore', 'zRank', 'zRem', 'zScore',
  "hIncrBy", "removeUser", "logout", "strLen", "zRemRangeByScore", "zMClear", "zClear", "setDomain", "showDomain", "delDomain"
]

export function initLAPI (apiPath, useWs = false) {
  return (useWs ? Hprose.Client.create : Hprose.HttpClient.bind(Hprose))(
    apiPath,
    apiMethods,
    {timeout}
    )
}
